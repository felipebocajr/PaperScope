<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Paper Rank ‚Äî AI Research Digest</title>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

  <style>
    :root {
      --bg:            #0b0f19;
      --card-bg:       #111827;
      --card-border:   #1f2937;
      --text-primary:  #f3f4f6;
      --text-secondary:#9ca3af;
      --accent:        #3b82f6;
      --accent-hover:  #60a5fa;
      --accent-bg:     rgba(59,130,246,0.1);
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      color-scheme: dark;
    }
    *, *::before, *::after { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    a { color: var(--accent); text-decoration: none; transition: color .2s; }
    a:hover { color: var(--accent-hover); }

    .top-bar {
      text-align: right;
      padding: 12px 20px 0;
      max-width: 1400px;
      margin: 0 auto;
      font-size: 12px;
      color: var(--text-secondary);
    }
    .top-bar a {
      color: var(--text-secondary);
      text-decoration: underline;
      text-decoration-color: rgba(156,163,175,.3);
      text-underline-offset: 4px;
      transition: all .2s;
    }
    .top-bar a:hover { color: var(--text-primary); }

    .container { max-width: 1400px; margin: 0 auto; padding: 24px 20px 32px; }

    .header { text-align: center; margin-bottom: 32px; }
    h1 {
      margin: 0 0 8px;
      font-size: 36px;
      font-weight: 800;
      letter-spacing: -1px;
      background: linear-gradient(to right,#fff,#9ca3af);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .muted { color: var(--text-secondary); }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 28px 32px;
      margin: 8px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,.3);
    }

    /* ‚îÄ‚îÄ LAYOUT FLEXBOX (Substitui o Grid) ‚îÄ‚îÄ */
    .page-layout {
      display: flex;
      gap: 32px;
      max-width: 1300px;
      margin: 0 auto;
      align-items: flex-start;
      justify-content: center;
    }

    .main-content {
      flex: 1;
      max-width: 920px;
      width: 100%;
      min-width: 0;
    }

    .sidebar-content {
      width: 320px;
      flex-shrink: 0;
      position: sticky;
      top: 24px;
      display: none; /* Oculto at√© carregar gloss√°rio */
    }

    @media (max-width: 1100px) {
      .page-layout { flex-direction: column; align-items: center; }
      .sidebar-content { width: 100%; max-width: 920px; position: static; }
    }

    /* CONTROLS (agora dentro do main-content) */
    .controls-card {
      margin: 0 0 16px 0;
    }
    .controls-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px 28px;
      align-items: start;
    }
    @media (max-width: 680px) { .controls-grid { grid-template-columns: 1fr; } }

    label.ctrl-label {
      display: block;
      font-size: 11px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    /* SELECT PADR√ÉO (Para Semana e T√≥pico) */
    select {
      width: 100%;
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 10px;
      padding: 10px 14px;
      color: var(--text-primary);
      font-size: 14px;
      cursor: pointer;
      transition: border-color .2s;
      font-family: inherit;
    }
    select:focus   { outline: none; border-color: var(--accent); }
    select:disabled { opacity: .5; cursor: not-allowed; }

    /* PAPER */
    .paper-header { text-align: center; margin-bottom: 24px; padding: 0 8px; }
    .paper-title  { margin: 16px 0; font-size: 26px; line-height: 1.35; font-weight: 800; }
    .paper-meta   { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; }
    .badge {
      display: inline-flex; align-items: center;
      padding: 6px 14px; border-radius: 8px;
      background: #1f2937; border: 1px solid #374151;
      font-size: 13px; font-weight: 500; color: #d1d5db;
    }

    /* SUMMARY */
    .summary { font-size: 16px; color: #d1d5db; line-height: 1.78; }
    .summary p { margin: 0 0 16px; }
    .summary p:last-child { margin-bottom: 0; }
    .summary strong { color: #fff; font-weight: 700; }
    .summary em { font-style: italic; color: #e5e7eb; }
    .summary h1,.summary h2,.summary h3,.summary h4 {
      color: #fff; margin: 24px 0 12px; font-weight: 600; line-height: 1.3;
    }
    .summary pre {
      background: #0f1117; border: 1px solid #374151;
      padding: 16px; border-radius: 12px; overflow-x: auto; margin: 0 0 16px;
    }

    .glossary-link {
      color: #93c5fd; background: rgba(59,130,246,.15);
      border-bottom: 1px dashed rgba(147,197,253,.6);
      cursor: pointer; font-weight: 500;
      padding: 2px 6px; border-radius: 4px;
      transition: all .2s; white-space: nowrap;
    }
    .glossary-link:hover { background: rgba(59,130,246,.3); color: #fff; }

    /* GLOSSARY */
    .glossary-header {
      font-size: 11px; font-weight: 700; color: #9ca3af;
      text-transform: uppercase; letter-spacing: 1.5px;
      margin-bottom: 12px; display: flex; align-items: center; gap: 6px;
    }
    .glossary-card {
      background: #1f2937; border: 1px solid #374151;
      border-radius: 8px; margin-bottom: 10px; overflow: hidden;
      transition: all .3s;
    }
    .glossary-card[open]       { border-color: #4b5563; background: #1a2332; }
    .glossary-card.highlighted { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,130,246,.3); transform: translateX(-4px); }
    .glossary-term {
      padding: 12px 14px; font-weight: 600; color: #f3f4f6;
      cursor: pointer; display: flex; justify-content: space-between;
      align-items: center; font-size: 13px; list-style: none; user-select: none;
    }
    .glossary-term::-webkit-details-marker { display: none; }
    .chevron-icon { transition: transform .3s; color: #9ca3af; flex-shrink: 0; }
    .glossary-card[open] .chevron-icon { transform: rotate(180deg); color: var(--accent); }
    .glossary-def {
      padding: 0 14px 14px; font-size: 13px; color: #9ca3af; line-height: 1.5;
      border-top: 1px solid transparent;
    }
    .glossary-card[open] .glossary-def { border-top: 1px solid #374151; padding-top: 10px; }

    /* SCORES */
    .scores-grid {
      display: grid; grid-template-columns: repeat(auto-fit,minmax(80px,1fr));
      gap: 16px; margin-top: 28px;
      background: var(--accent-bg); padding: 24px; border-radius: 12px;
      border: 1px solid rgba(59,130,246,.2);
    }
    .score-item { display: flex; flex-direction: column; align-items: center; text-align: center; }
    .score-value { font-size: 28px; font-weight: 800; color: var(--text-primary); line-height: 1; margin-bottom: 8px; }
    .score-item:first-child .score-value { color: var(--accent-hover); }
    .score-label { font-size: 10px; font-weight: 700; color: var(--accent-hover); text-transform: uppercase; letter-spacing: .5px; }

    .authors {
      margin-top: 28px; padding-top: 24px;
      border-top: 1px solid var(--card-border);
      color: var(--text-secondary); font-size: 14px; text-align: center;
    }
    .read-more-btn {
      display: inline-flex; align-items: center;
      margin-top: 16px; padding: 10px 20px;
      background: var(--text-primary); color: #000;
      border-radius: 8px; font-weight: 600; font-size: 14px;
      transition: transform .2s, background .2s;
    }
    .read-more-btn:hover { background: #fff; transform: translateY(-2px); }

    /* FEEDBACK */
    .feedback-box { margin-top: 8px; }
    .feedback-box input,
    .feedback-box textarea {
      width: 100%; background: #1f2937; border: 1px solid #374151;
      border-radius: 10px; padding: 10px 14px;
      color: var(--text-primary); font-size: 14px; font-family: inherit;
      transition: border-color .2s; resize: vertical;
    }
    .feedback-box input:focus,
    .feedback-box textarea:focus { outline: none; border-color: var(--accent); }

    /* STATES */
    .state-card {
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; gap: 12px; min-height: 200px;
      color: var(--text-secondary); text-align: center;
    }

    .footer {
      margin-top: 32px; padding: 24px 0 40px;
      font-size: 13px; text-align: center;
      border-top: 1px solid var(--card-border);
    }
  </style>
</head>
<body>

  <div class="top-bar">
    Desenvolvido por <a href="https://www.linkedin.com/in/felipe-bochini/" target="_blank" rel="noopener noreferrer">Felipe Bochini</a>
  </div>

  <header class="container header">
    <h1>Paper Rank</h1>
    <p class="muted">Os melhores artigos de IA do arXiv, selecionados e classificados por Intelig√™ncia Artificial.</p>
  </header>

  <main class="container">

    <div class="page-layout" id="pageLayout">
      
      <div class="main-content">
        
        <div class="card controls-card">
          <div class="controls-grid">
            <div>
              <label class="ctrl-label" for="weekSelect">Per√≠odo de Extra√ß√£o</label>
              <select id="weekSelect" disabled>
                <option value="" disabled selected>Carregando...</option>
              </select>
            </div>

            <div>
              <label class="ctrl-label" for="topicSelect">T√≥pico de Pesquisa</label>
              <select id="topicSelect" disabled>
                <option value="" disabled selected>Selecione um t√≥pico...</option>
              </select>
            </div>
          </div>
        </div>

        <section id="paper"></section>
        
        <section class="card feedback-box">
          <h3 style="text-align:center;margin:0 0 8px">Compartilhe seu Feedback</h3>
          <p class="muted" style="font-size:14px;margin-top:0;text-align:center">Ajude-nos a melhorar o Paper Rank.</p>
          <div style="display:flex;flex-direction:column;gap:12px;margin-top:16px">
            <input type="email" id="feedbackEmail" placeholder="E-mail (opcional)">
            <textarea id="feedbackMessage" rows="3" placeholder="O que voc√™ achou?..."></textarea>
            <button onclick="sendFeedback()" id="submitBtn"
              style="background:var(--accent);color:#fff;border:none;padding:14px 28px;border-radius:12px;
                     font-weight:600;font-size:15px;cursor:pointer;width:100%;max-width:200px;
                     margin:0 auto;font-family:inherit">
              Enviar Feedback
            </button>
            <p id="formStatus" style="font-size:12px;margin-top:4px;display:none;text-align:center"></p>
          </div>
        </section>

      </div>

      <div class="sidebar-content" id="glossarySidebar"></div>

    </div>

    <footer class="footer muted"><div id="footerMeta"></div></footer>
  </main>

  <script>
    const els = {
      week:       document.getElementById('weekSelect'),
      topic:      document.getElementById('topicSelect'),
      paper:      document.getElementById('paper'),
      sidebar:    document.getElementById('glossarySidebar'),
      pageLayout: document.getElementById('pageLayout'),
    };

    let weeksList       = [];
    let currentWeekData = null;

    marked.setOptions({ breaks: true, gfm: true });

    /* ‚îÄ‚îÄ Formata√ß√£o de Datas ‚îÄ‚îÄ */
    function formatWeekLabel(rangeStr) {
      // Ex: "2026-02-22_to_2026-03-01"
      if (!rangeStr.includes('_to_')) {
        // Fallback caso o script ainda encontre datas antigas ("2026-03-01")
        const d = new Date(rangeStr + 'T12:00:00');
        return d.toLocaleDateString('pt-BR', {day:'2-digit', month:'short', year:'numeric'}).replace('.','');
      }

      const [startStr, endStr] = rangeStr.split('_to_');
      const start = new Date(startStr + 'T12:00:00');
      const end   = new Date(endStr + 'T12:00:00');
      
      const fmt = d => d.toLocaleDateString('pt-BR', {day:'2-digit', month:'short', year:'numeric'}).replace('.','');
      return `${fmt(start)} ‚Äì ${fmt(end)}`;
    }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    function setSidebarVisible(yes) {
      els.sidebar.style.display = yes ? 'block' : 'none';
    }
    function clearSidebar() { els.sidebar.innerHTML = ''; setSidebarVisible(false); }

    /* ‚îÄ‚îÄ States ‚îÄ‚îÄ */
    function showLoader(msg='Carregando...') {
      clearSidebar();
      els.paper.innerHTML = `<div class="card"><div class="state-card"><div>${msg}</div></div></div>`;
    }
    function showError(msg) {
      clearSidebar();
      els.paper.innerHTML = `<div class="card"><div class="state-card" style="color:#ef4444">
        <div style="font-weight:600">N√£o foi poss√≠vel exibir o ranking</div>
        <div style="font-size:14px;color:var(--text-secondary);margin-top:4px">${msg}</div>
      </div></div>`;
    }
    function renderWelcome() {
      clearSidebar();
      els.paper.innerHTML = `<div class="card"><div class="state-card">
        <div style="font-size:40px">‚ú®</div>
        <h2 style="margin:0;font-size:22px">Explore as Pesquisas de IA</h2>
        <p class="muted" style="margin:0;max-width:380px;font-size:15px">Selecione uma semana e um t√≥pico acima para mergulhar nos artigos mais inovadores.</p>
      </div></div>`;
    }

    /* ‚îÄ‚îÄ Glossary highlight ‚îÄ‚îÄ */
    window.highlightGlossary = function(id) {
      const card = document.getElementById(id);
      if (!card) return;
      card.open = true;
      card.scrollIntoView({ behavior:'smooth', block:'center' });
      card.classList.add('highlighted');
      setTimeout(() => card.classList.remove('highlighted'), 2000);
    };

    /* ‚îÄ‚îÄ Render paper ‚îÄ‚îÄ */
    function renderPaper() {
      if (!currentWeekData) return;
      const topicKey = els.topic.value;
      if (!topicKey) { renderWelcome(); return; }

      const topic = (currentWeekData.topics || {})[topicKey];
      if (!topic?.paper) {
        clearSidebar();
        els.paper.innerHTML = `<div class="card"><div class="state-card">
          <div style="font-size:40px">üì≠</div><div style="font-weight:500">Nenhum artigo encontrado</div>
        </div></div>`;
        return;
      }

      const p       = topic.paper;
      const authors = Array.isArray(p.authors) ? p.authors : [];
      const scores  = p.scores || {};

      let summaryHtml = p.summary ? marked.parse(p.summary) : "<span class='muted'>(Sum√°rio vazio)</span>";

      const hasGlossary = p.glossary && Object.keys(p.glossary).length > 0;
      let glossaryHtml  = '';

      if (hasGlossary) {
        glossaryHtml = `<div class="glossary-header">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
          </svg>Gloss√°rio</div>`;

        Object.keys(p.glossary).sort((a,b) => b.length - a.length).forEach(term => {
          const id = 'gl-' + encodeURIComponent(term).replace(/%/g,'');
          glossaryHtml += `<details id="${id}" class="glossary-card">
            <summary class="glossary-term">${term}
              <svg class="chevron-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
            </summary>
            <div class="glossary-def">${p.glossary[term]}</div>
          </details>`;
          const esc   = term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
          const regex = new RegExp(`(?<!<[^>]*)\\b(${esc})\\b(?![^<]*>)`, 'gi');
          summaryHtml = summaryHtml.replace(regex, `<span class="glossary-link" onclick="highlightGlossary('${id}')" title="Ver defini√ß√£o">$1</span>`);
        });
      }

      els.sidebar.innerHTML = glossaryHtml;
      setSidebarVisible(hasGlossary);

      els.paper.innerHTML = `
        <div class="paper-header">
          ${p.published ? `<div class="paper-meta"><span class="badge">üìù Publicado em: ${p.published}</span></div>` : ''}
          <h2 class="paper-title"><a href="${p.arxiv_url}" target="_blank" rel="noopener noreferrer">${p.title}</a></h2>
        </div>
        <div class="card">
          <div class="summary">${summaryHtml}</div>
          ${scores.weighted ? `
          <div class="scores-grid">
            <div class="score-item"><span class="score-value">${scores.weighted.toFixed(1)}</span><span class="score-label">Global Rank</span></div>
            <div class="score-item"><span class="score-value">${scores.innovation  ? scores.innovation.toFixed(1)  : '-'}</span><span class="score-label">Inova√ß√£o</span></div>
            <div class="score-item"><span class="score-value">${scores.impact      ? scores.impact.toFixed(1)      : '-'}</span><span class="score-label">Impacto</span></div>
            <div class="score-item"><span class="score-value">${scores.methodology ? scores.methodology.toFixed(1) : '-'}</span><span class="score-label">Metodologia</span></div>
            <div class="score-item"><span class="score-value">${scores.topic_fit   ? scores.topic_fit.toFixed(1)   : '-'}</span><span class="score-label">Topic Fit</span></div>
          </div>` : ''}
          <div class="authors">
            <strong>Autores:</strong> ${authors.join(', ') || 'Desconhecido'}
            <div style="margin-top:20px"><a href="${p.arxiv_url}" class="read-more-btn" target="_blank" rel="noopener noreferrer">Ler Artigo Completo no arXiv</a></div>
          </div>
        </div>`;

      renderMathInElement(els.pageLayout, {
        delimiters: [{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false},{left:'\\(',right:'\\)',display:false}],
        throwOnError: false
      });
    }

    /* ‚îÄ‚îÄ Data ‚îÄ‚îÄ */
    async function fetchJson(path) {
      const res = await fetch(path, { cache:'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    async function loadWeekData(weekDate, targetTopic) {
      try {
        showLoader('Buscando classifica√ß√£o...');
        els.topic.disabled = true;
        currentWeekData = await fetchJson(`weeks/${weekDate}.json`);

        const topicsObj  = currentWeekData.topics || {};
        const topicItems = Object.keys(topicsObj).map(k => ({ value:k, label: topicsObj[k]?.topic_name || k }));

        els.topic.innerHTML = '<option value="" disabled selected>Selecione um t√≥pico...</option>';
        topicItems.forEach(it => {
          const opt = document.createElement('option');
          opt.value = it.value; opt.textContent = it.label;
          els.topic.appendChild(opt);
        });
        els.topic.disabled = false;

        if (targetTopic && topicItems.some(t => t.value === targetTopic)) {
          els.topic.value = targetTopic; renderPaper();
        } else {
          els.topic.value = ''; renderWelcome();
        }

        const u = new URL(window.location.href);
        u.searchParams.set('week', weekDate);
        if (els.topic.value) u.searchParams.set('topic', els.topic.value);
        else u.searchParams.delete('topic');
        history.replaceState(null, '', u.toString());

      } catch { showError('O resumo da pesquisa est√° temporariamente indispon√≠vel.'); }
    }

    /* ‚îÄ‚îÄ Feedback ‚îÄ‚îÄ */
    async function sendFeedback() {
      const email  = document.getElementById('feedbackEmail').value;
      const msg    = document.getElementById('feedbackMessage').value;
      const btn    = document.getElementById('submitBtn');
      const status = document.getElementById('formStatus');
      if (!msg.trim()) { alert('Por favor, insira uma mensagem.'); return; }
      btn.disabled = true; btn.innerText = 'Enviando...';
      status.style.display = 'block'; status.innerText = 'Processando...';
      try {
        const res = await fetch('https://formspree.io/f/mkovedzd', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, message:msg, topic:els.topic.value, week:els.week.value })
        });
        if (res.ok) {
          status.innerText = '‚úì Obrigado! Feedback enviado.'; status.style.color = '#10b981';
          document.getElementById('feedbackMessage').value = '';
          document.getElementById('feedbackEmail').value   = '';
          btn.innerText = 'Enviado!';
        } else throw new Error();
      } catch {
        status.innerText = '‚úó Falha ao enviar.'; status.style.color = '#ef4444';
        btn.disabled = false; btn.innerText = 'Tentar Novamente';
      }
    }

    /* ‚îÄ‚îÄ Bootstrap ‚îÄ‚îÄ */
    async function main() {
      try {
        showLoader('Sincronizando...');
        weeksList = await fetchJson('weeks.json');
        if (!weeksList || !weeksList.length) { showError('Nenhum dado encontrado.'); return; }

        // Popula o seletor de semanas
        els.week.innerHTML = '';
        weeksList.forEach(w => {
          const opt = document.createElement('option');
          opt.value = w;
          opt.textContent = formatWeekLabel(w);
          els.week.appendChild(opt);
        });
        els.week.disabled = false;

        const u         = new URL(window.location.href);
        const paramWeek = u.searchParams.get('week');
        
        // Verifica se a semana da URL existe na lista, se n√£o pega a √∫ltima extra√≠da
        const selectedWeek = (paramWeek && weeksList.includes(paramWeek)) ? paramWeek : weeksList[0];
        els.week.value = selectedWeek;

        await loadWeekData(selectedWeek, u.searchParams.get('topic'));

        // Listeners
        els.week.onchange = () => {
          loadWeekData(els.week.value, els.topic.value);
        };

        els.topic.onchange = () => {
          const nu = new URL(window.location.href);
          nu.searchParams.set('week', els.week.value);
          nu.searchParams.set('topic', els.topic.value);
          history.replaceState(null, '', nu.toString());
          renderPaper();
        };

      } catch { showError('Falha ao conectar ao servi√ßo Paper Rank.'); }
    }

    main();
  </script>
</body>
</html>