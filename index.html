<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Paper Rank ‚Äî AI Research Digest</title>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>

  <style>
    :root {
      --bg:            #0b0f19;
      --card-bg:       #111827;
      --card-border:   #1f2937;
      --text-primary:  #f3f4f6;
      --text-secondary:#9ca3af;
      --accent:        #3b82f6;
      --accent-hover:  #60a5fa;
      --accent-bg:     rgba(59,130,246,0.1);
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      color-scheme: dark;
    }
    *, *::before, *::after { box-sizing: border-box; }

    body {
      margin: 0;
      background: var(--bg);
      color: var(--text-primary);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    a { color: var(--accent); text-decoration: none; transition: color .2s; }
    a:hover { color: var(--accent-hover); }

    .top-bar {
      text-align: right;
      padding: 12px 20px 0;
      max-width: 1400px;
      margin: 0 auto;
      font-size: 12px;
      color: var(--text-secondary);
    }
    .top-bar a {
      color: var(--text-secondary);
      text-decoration: underline;
      text-decoration-color: rgba(156,163,175,.3);
      text-underline-offset: 4px;
      transition: all .2s;
    }
    .top-bar a:hover { color: var(--text-primary); }

    .container { max-width: 1400px; margin: 0 auto; padding: 24px 20px 32px; }

    .header { text-align: center; margin-bottom: 32px; }
    h1 {
      margin: 0 0 8px;
      font-size: 36px;
      font-weight: 800;
      letter-spacing: -1px;
      background: linear-gradient(to right,#fff,#9ca3af);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .muted { color: var(--text-secondary); }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      padding: 28px 32px;
      margin: 8px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,.3);
    }

    /* ‚îÄ‚îÄ PAGE LAYOUT ‚îÄ‚îÄ */
    .page-layout {
      max-width: 1280px;
      margin: 0 auto;
      width: 100%;
      display: grid;
      grid-template-columns: 280px minmax(0, 1fr);
      gap: 28px;
      align-items: start;
    }

    .filters-panel {
      position: sticky;
      top: 16px;
    }

    .main-content {
      max-width: 920px;
      width: 100%;
      margin: 0 auto;
    }

    @media (max-width: 1024px) {
      .page-layout { grid-template-columns: 1fr; gap: 16px; }
      .filters-panel { position: static; }
      .main-content { max-width: 100%; }
    }

    /* CONTROLS */
    .controls-card { margin: 0; }
    .controls-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      align-items: start;
    }

    label.ctrl-label {
      display: block;
      font-size: 11px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    /* SELECT STYLES */
    select {
      width: 100%;
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 10px;
      padding: 10px 14px;
      color: var(--text-primary);
      font-size: 14px;
      cursor: pointer;
      transition: border-color .2s;
      font-family: inherit;
    }
    select:focus   { outline: none; border-color: var(--accent); }
    select:disabled { opacity: .5; cursor: not-allowed; }

    /* PAPER */
    .paper-header {
      text-align: center;
      margin-bottom: 16px;
      padding: 20px 24px;
      background: var(--card-bg);
      border: 1px solid var(--card-border);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,.3);
    }
    .paper-title  { margin: 14px 0 0; font-size: 28px; line-height: 1.3; font-weight: 800; letter-spacing: -0.4px; }
    .paper-title a { color: var(--text-primary); transition: color .2s; }
    .paper-title a:hover { color: var(--accent-hover); }
    .paper-meta   { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; }
    .badge {
      display: inline-flex; align-items: center;
      padding: 8px 16px; border-radius: 999px;
      background: var(--accent-bg); border: 1px solid rgba(59,130,246,.35);
      font-size: 12px; font-weight: 700; color: #bfdbfe;
      letter-spacing: .2px;
    }

    /* SUMMARY */
    .summary { font-size: 16px; color: #d1d5db; line-height: 1.78; }
    .summary p { margin: 0 0 16px; }
    .summary p:last-child { margin-bottom: 0; }
    .summary strong { color: #fff; font-weight: 700; }
    .summary em { font-style: italic; color: #e5e7eb; }
    .summary h1,.summary h2,.summary h3,.summary h4 {
      color: #fff; margin: 24px 0 12px; font-weight: 600; line-height: 1.3;
    }
    .summary pre {
      background: #0f1117; border: 1px solid #374151;
      padding: 16px; border-radius: 12px; overflow-x: auto; margin: 0 0 16px;
    }

    .glossary-link {
      color: #93c5fd; background: rgba(59,130,246,.15);
      border-bottom: 1px dashed rgba(147,197,253,.6);
      cursor: pointer; font-weight: 500;
      padding: 2px 6px; border-radius: 4px;
      transition: all .2s; white-space: nowrap;
    }
    .glossary-link:hover { background: rgba(59,130,246,.3); color: #fff; }

    /* ‚îÄ‚îÄ SLIDING SIDEBAR (GLOSSARY) ‚îÄ‚îÄ */
    .sidebar-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.6);
      z-index: 998; opacity: 0; pointer-events: none; transition: opacity 0.3s ease;
    }
    .sidebar-backdrop.open { opacity: 1; pointer-events: auto; }

    .sidebar-content {
      position: fixed; top: 0; right: -400px;
      width: 100%; max-width: 380px; height: 100vh;
      background: var(--bg);
      border-left: 1px solid var(--card-border);
      padding: 0;
      overflow-y: auto;
      transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 999;
      box-shadow: -8px 0 30px rgba(0,0,0,0.6);
    }
    .sidebar-content.open { right: 0; }

    .sidebar-inner {
      padding: 24px 20px;
      display: flex; flex-direction: column; min-height: 100%;
    }

    /* GLOSSARY TAB BUTTON (Floating) */
    .glossary-tab {
      position: fixed; top: 50%; right: 0; transform: translateY(-50%);
      background: var(--card-bg); border: 1px solid var(--card-border); border-right: none;
      padding: 12px 16px; border-radius: 12px 0 0 12px;
      cursor: pointer; z-index: 900;
      display: none; /* hidden until paper has a glossary */
      align-items: center; gap: 8px;
      font-weight: 600; font-size: 14px; color: var(--text-primary);
      box-shadow: -4px 4px 12px rgba(0,0,0,0.4);
      transition: background 0.2s, right 0.3s, transform 0.2s;
    }
    .glossary-tab:hover {
      background: #1f2937; color: var(--accent-hover);
      transform: translateY(-50%) scale(1.02);
    }
    .glossary-tab.hidden { right: -150px; }

    .glossary-header {
      font-weight: 700; color: #f3f4f6;
      text-transform: uppercase; letter-spacing: 1px;
    }
    .glossary-card {
      background: #1f2937; border: 1px solid #374151;
      border-radius: 8px; margin-bottom: 10px; overflow: hidden;
      transition: all .3s;
    }
    .glossary-card[open]       { border-color: #4b5563; background: #1a2332; }
    .glossary-card.highlighted { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(59,130,246,.4); transform: translateX(-4px); }
    .glossary-term {
      padding: 12px 14px; font-weight: 600; color: #f3f4f6;
      cursor: pointer; display: flex; justify-content: space-between;
      align-items: center; font-size: 13px; list-style: none; user-select: none;
    }
    .glossary-term::-webkit-details-marker { display: none; }
    .chevron-icon { transition: transform .3s; color: #9ca3af; flex-shrink: 0; }
    .glossary-card[open] .chevron-icon { transform: rotate(180deg); color: var(--accent); }
    .glossary-def {
      padding: 0 14px 14px; font-size: 13px; color: #9ca3af; line-height: 1.5;
      border-top: 1px solid transparent;
    }
    .glossary-card[open] .glossary-def { border-top: 1px solid #374151; padding-top: 10px; }

    .close-btn {
      background: none; border: none; color: #9ca3af; cursor: pointer; 
      font-size: 24px; line-height: 1; padding: 0 4px; transition: color 0.2s;
    }
    .close-btn:hover { color: #f3f4f6; }

    /* SCORES */
    .scores-grid {
      display: grid; grid-template-columns: repeat(auto-fit,minmax(80px,1fr));
      gap: 16px; margin-top: 28px;
      background: var(--accent-bg); padding: 24px; border-radius: 12px;
      border: 1px solid rgba(59,130,246,.2);
    }
    .score-item { display: flex; flex-direction: column; align-items: center; text-align: center; }
    .score-value { font-size: 28px; font-weight: 800; color: var(--text-primary); line-height: 1; margin-bottom: 8px; }
    .score-item:first-child .score-value { color: var(--accent-hover); }
    .score-label { font-size: 10px; font-weight: 700; color: var(--accent-hover); text-transform: uppercase; letter-spacing: .5px; }

    .authors {
      margin-top: 28px; padding-top: 24px;
      border-top: 1px solid var(--card-border);
      color: var(--text-secondary); font-size: 14px; text-align: center;
    }
    .read-more-btn {
      display: inline-flex; align-items: center;
      margin-top: 16px; padding: 10px 20px;
      background: var(--text-primary); color: #000;
      border-radius: 8px; font-weight: 600; font-size: 14px;
      transition: transform .2s, background .2s;
    }
    .read-more-btn:hover { background: #fff; transform: translateY(-2px); }

    /* FEEDBACK */
    .feedback-box { margin-top: 28px; }
    .feedback-box input,
    .feedback-box textarea {
      width: 100%; background: #1f2937; border: 1px solid #374151;
      border-radius: 10px; padding: 10px 14px;
      color: var(--text-primary); font-size: 14px; font-family: inherit;
      transition: border-color .2s; resize: vertical;
    }
    .feedback-box input:focus,
    .feedback-box textarea:focus { outline: none; border-color: var(--accent); }

    /* STATES */
    .state-card {
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; gap: 12px; min-height: 200px;
      color: var(--text-secondary); text-align: center;
    }

    .footer {
      margin-top: 32px; padding: 24px 0 40px;
      font-size: 13px; text-align: center;
      border-top: 1px solid var(--card-border);
    }
  </style>
</head>
<body>

  <div class="top-bar">
    Developed by <a href="https://www.linkedin.com/in/felipe-bochini/" target="_blank" rel="noopener noreferrer">Felipe Bochini</a>
  </div>

  <header class="container header">
    <h1>Paper Rank</h1>
    <p class="muted">The best AI papers from arXiv, curated and ranked by Artificial Intelligence.</p>
  </header>

  <main class="container">

    <div class="page-layout" id="pageLayout">
      
      <!-- MAIN CONTENT: Filters + Paper + Feedback -->
      <!-- Filters Widget -->
      <aside class="filters-panel">
        <div class="card controls-card">
          <div class="controls-grid">
            <!-- Week Range Selector -->
            <div>
              <label class="ctrl-label" for="weekSelect">Extraction Period</label>
              <select id="weekSelect" disabled>
                <option value="" disabled selected>Loading...</option>
              </select>
            </div>

            <!-- Topic Selector -->
            <div>
              <label class="ctrl-label" for="topicSelect">Research Topic</label>
              <select id="topicSelect" disabled>
                <option value="" disabled selected>Select a topic...</option>
              </select>
            </div>
          </div>
        </div>

      </aside>

      <div class="main-content">

        <!-- Paper Area -->
        <section id="paper"></section>
        
        <!-- Feedback -->
        <section class="card feedback-box">
          <h3 style="text-align:center;margin:0 0 8px">Share your Feedback</h3>
          <p class="muted" style="font-size:14px;margin-top:0;text-align:center">Help us improve Paper Rank.</p>
          <div style="display:flex;flex-direction:column;gap:12px;margin-top:16px">
            <input type="email" id="feedbackEmail" placeholder="Email (optional)">
            <textarea id="feedbackMessage" rows="3" placeholder="What do you think?..."></textarea>
            <button onclick="sendFeedback()" id="submitBtn"
              style="background:var(--accent);color:#fff;border:none;padding:14px 28px;border-radius:12px;
                     font-weight:600;font-size:15px;cursor:pointer;width:100%;max-width:200px;
                     margin:0 auto;font-family:inherit">
              Submit Feedback
            </button>
            <p id="formStatus" style="font-size:12px;margin-top:4px;display:none;text-align:center"></p>
          </div>
        </section>

      </div>

    </div>

    <!-- ‚îÄ‚îÄ FLOATING UI FOR GLOSSARY ‚îÄ‚îÄ -->
    <div id="sidebarBackdrop" class="sidebar-backdrop" onclick="toggleGlossary(false)"></div>
    <div class="sidebar-content" id="glossarySidebar"></div>
    <button id="glossaryTab" class="glossary-tab" onclick="toggleGlossary(true)">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
      </svg>
      Glossary
    </button>

    <footer class="footer muted"><div id="footerMeta"></div></footer>
  </main>

  <script>
    const els = {
      week:       document.getElementById('weekSelect'),
      topic:      document.getElementById('topicSelect'),
      paper:      document.getElementById('paper'),
      sidebar:    document.getElementById('glossarySidebar'),
      backdrop:   document.getElementById('sidebarBackdrop'),
      tab:        document.getElementById('glossaryTab')
    };

    let weeksList       = [];
    let currentWeekData = null;

    marked.setOptions({ breaks: true, gfm: true });

    /* ‚îÄ‚îÄ Date Formatting ‚îÄ‚îÄ */
    function formatWeekLabel(rangeStr) {
      const opts = { month: 'short', day: '2-digit', year: 'numeric' };
      
      // Handles both old string formats ("2026-03-01") and new ("2026-02-22_to_2026-03-01")
      if (!rangeStr.includes('_to_')) {
        const end = new Date(rangeStr + 'T12:00:00');
        const start = new Date(end.getTime() - 6 * 24 * 60 * 60 * 1000);
        return `${start.toLocaleDateString('en-US', opts)} ‚Äî ${end.toLocaleDateString('en-US', opts)}`;
      }

      const [startStr, endStr] = rangeStr.split('_to_');
      const start = new Date(startStr + 'T12:00:00');
      const end   = new Date(endStr + 'T12:00:00');
      
      return `${start.toLocaleDateString('en-US', opts)} ‚Äî ${end.toLocaleDateString('en-US', opts)}`;
    }

    /* ‚îÄ‚îÄ Drawer UI ‚îÄ‚îÄ */
    function toggleGlossary(show) {
      if (show) {
        els.sidebar.classList.add('open');
        els.backdrop.classList.add('open');
        els.tab.classList.add('hidden');
      } else {
        els.sidebar.classList.remove('open');
        els.backdrop.classList.remove('open');
        els.tab.classList.remove('hidden');
      }
    }

    function setSidebarVisible(hasGlossary) {
      if (hasGlossary) {
        els.tab.style.display = 'flex';
        els.tab.classList.remove('hidden');
      } else {
        els.tab.style.display = 'none';
        toggleGlossary(false);
      }
    }

    /* ‚îÄ‚îÄ States ‚îÄ‚îÄ */
    function showLoader(msg='Loading...') {
      setSidebarVisible(false);
      els.paper.innerHTML = `<div class="card"><div class="state-card"><div>${msg}</div></div></div>`;
    }
    function showError(msg) {
      setSidebarVisible(false);
      els.paper.innerHTML = `<div class="card"><div class="state-card" style="color:#ef4444">
        <div style="font-weight:600">Could not display the ranking</div>
        <div style="font-size:14px;color:var(--text-secondary);margin-top:4px">${msg}</div>
      </div></div>`;
    }
    function renderWelcome() {
      setSidebarVisible(false);
      els.paper.innerHTML = `<div class="card"><div class="state-card">
        <div style="font-size:40px">‚ú®</div>
        <h2 style="margin:0;font-size:22px">Explore AI Research</h2>
        <p class="muted" style="margin:0;max-width:380px;font-size:15px">Select a week and a topic above to dive into the most innovative papers.</p>
      </div></div>`;
    }

    /* ‚îÄ‚îÄ Glossary highlight ‚îÄ‚îÄ */
    window.highlightGlossary = function(id) {
      toggleGlossary(true);
      // Timeout to allow the sidebar to slide out before scrolling to the card
      setTimeout(() => {
        const card = document.getElementById(id);
        if (!card) return;
        card.open = true;
        card.scrollIntoView({ behavior:'smooth', block:'center' });
        card.classList.add('highlighted');
        setTimeout(() => card.classList.remove('highlighted'), 2000);
      }, 300);
    };

    /* ‚îÄ‚îÄ Render paper ‚îÄ‚îÄ */
    function renderPaper() {
      if (!currentWeekData) return;
      const topicKey = els.topic.value;
      if (!topicKey) { renderWelcome(); return; }

      const topic = (currentWeekData.topics || {})[topicKey];
      if (!topic?.paper) {
        setSidebarVisible(false);
        els.paper.innerHTML = `<div class="card"><div class="state-card">
          <div style="font-size:40px">üì≠</div><div style="font-weight:500">No papers found</div>
        </div></div>`;
        return;
      }

      const p       = topic.paper;
      const authors = Array.isArray(p.authors) ? p.authors : [];
      const scores  = p.scores || {};

      let summaryHtml = p.summary ? marked.parse(p.summary) : "<span class='muted'>(Empty summary)</span>";

      const hasGlossary = p.glossary && Object.keys(p.glossary).length > 0;
      let glossaryHtml  = '';

      if (hasGlossary) {
        glossaryHtml = `
          <div class="sidebar-inner">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 24px;">
              <div class="glossary-header" style="margin:0; font-size:14px; display:flex; align-items:center; gap:8px;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
                </svg> Glossary
              </div>
              <button class="close-btn" onclick="toggleGlossary(false)">&times;</button>
            </div>
            <div class="glossary-cards">
        `;

        Object.keys(p.glossary).sort((a,b) => b.length - a.length).forEach(term => {
          const id = 'gl-' + encodeURIComponent(term).replace(/%/g,'');
          glossaryHtml += `<details id="${id}" class="glossary-card">
            <summary class="glossary-term">${term}
              <svg class="chevron-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
            </summary>
            <div class="glossary-def">${p.glossary[term]}</div>
          </details>`;
          const esc   = term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
          const regex = new RegExp(`(?<!<[^>]*)\\b(${esc})\\b(?![^<]*>)`, 'gi');
          summaryHtml = summaryHtml.replace(regex, `<span class="glossary-link" onclick="highlightGlossary('${id}')" title="View definition">$1</span>`);
        });

        glossaryHtml += `</div></div>`;
      }

      els.sidebar.innerHTML = glossaryHtml;
      setSidebarVisible(hasGlossary);

      els.paper.innerHTML = `
        <div class="paper-header">
          ${p.published ? `<div class="paper-meta"><span class="badge">üìù Published on: ${p.published}</span></div>` : ''}
          <h2 class="paper-title"><a href="${p.arxiv_url}" target="_blank" rel="noopener noreferrer">${p.title}</a></h2>
        </div>
        <div class="card">
          <div class="summary">${summaryHtml}</div>
          ${scores.weighted ? `
          <div class="scores-grid">
            <div class="score-item"><span class="score-value">${scores.weighted.toFixed(1)}</span><span class="score-label">Global Rank</span></div>
            <div class="score-item"><span class="score-value">${scores.innovation  ? scores.innovation.toFixed(1)  : '-'}</span><span class="score-label">Innovation</span></div>
            <div class="score-item"><span class="score-value">${scores.impact      ? scores.impact.toFixed(1)      : '-'}</span><span class="score-label">Impact</span></div>
            <div class="score-item"><span class="score-value">${scores.methodology ? scores.methodology.toFixed(1) : '-'}</span><span class="score-label">Methodology</span></div>
            <div class="score-item"><span class="score-value">${scores.topic_fit   ? scores.topic_fit.toFixed(1)   : '-'}</span><span class="score-label">Topic Fit</span></div>
          </div>` : ''}
          <div class="authors">
            <strong>Authors:</strong> ${authors.join(', ') || 'Unknown'}
            <div style="margin-top:20px"><a href="${p.arxiv_url}" class="read-more-btn" target="_blank" rel="noopener noreferrer">Read Full Paper on arXiv</a></div>
          </div>
        </div>`;

      renderMathInElement(document.getElementById('pageLayout'), {
        delimiters: [{left:'$$',right:'$$',display:true},{left:'$',right:'$',display:false},{left:'\\(',right:'\\)',display:false}],
        throwOnError: false
      });
    }

    /* ‚îÄ‚îÄ Data ‚îÄ‚îÄ */
    async function fetchJson(path) {
      const res = await fetch(path, { cache:'no-store' });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    }

    async function loadWeekData(weekDate, targetTopic) {
      try {
        showLoader('Fetching ranking...');
        els.topic.disabled = true;
        currentWeekData = await fetchJson(`weeks/${weekDate}.json`);

        const topicsObj  = currentWeekData.topics || {};
        const topicItems = Object.keys(topicsObj).map(k => ({ value:k, label: topicsObj[k]?.topic_name || k }));

        els.topic.innerHTML = '<option value="" disabled selected>Select a topic...</option>';
        topicItems.forEach(it => {
          const opt = document.createElement('option');
          opt.value = it.value; opt.textContent = it.label;
          els.topic.appendChild(opt);
        });
        els.topic.disabled = false;

        if (targetTopic && topicItems.some(t => t.value === targetTopic)) {
          els.topic.value = targetTopic; renderPaper();
        } else {
          els.topic.value = ''; renderWelcome();
        }

        const u = new URL(window.location.href);
        u.searchParams.set('week', weekDate);
        if (els.topic.value) u.searchParams.set('topic', els.topic.value);
        else u.searchParams.delete('topic');
        history.replaceState(null, '', u.toString());

      } catch { showError('The research digest is temporarily unavailable.'); }
    }

    /* ‚îÄ‚îÄ Feedback ‚îÄ‚îÄ */
    async function sendFeedback() {
      const email  = document.getElementById('feedbackEmail').value;
      const msg    = document.getElementById('feedbackMessage').value;
      const btn    = document.getElementById('submitBtn');
      const status = document.getElementById('formStatus');
      
      if (!msg.trim()) { alert('Please enter a message.'); return; }
      
      btn.disabled = true; btn.innerText = 'Sending...';
      status.style.display = 'block'; status.innerText = 'Processing...';
      
      try {
        const res = await fetch('https://formspree.io/f/mkovedzd', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ email, message:msg, topic:els.topic.value, week:els.week.value })
        });
        if (res.ok) {
          status.innerText = '‚úì Thank you! Feedback sent.'; status.style.color = '#10b981';
          document.getElementById('feedbackMessage').value = '';
          document.getElementById('feedbackEmail').value   = '';
          btn.innerText = 'Sent!';
        } else throw new Error();
      } catch {
        status.innerText = '‚úó Failed to send.'; status.style.color = '#ef4444';
        btn.disabled = false; btn.innerText = 'Try Again';
      }
    }

    /* ‚îÄ‚îÄ Bootstrap ‚îÄ‚îÄ */
    async function main() {
      try {
        showLoader('Syncing...');
        weeksList = await fetchJson('weeks.json');
        if (!weeksList || !weeksList.length) { showError('No data found.'); return; }

        // Populate weeks selector
        els.week.innerHTML = '';
        weeksList.forEach(w => {
          const opt = document.createElement('option');
          opt.value = w;
          opt.textContent = formatWeekLabel(w);
          els.week.appendChild(opt);
        });
        els.week.disabled = false;

        const u         = new URL(window.location.href);
        const paramWeek = u.searchParams.get('week');
        
        // Checks if URL week exists, otherwise defaults to the latest
        const selectedWeek = (paramWeek && weeksList.includes(paramWeek)) ? paramWeek : weeksList[0];
        els.week.value = selectedWeek;

        await loadWeekData(selectedWeek, u.searchParams.get('topic'));

        // Listeners
        els.week.onchange = () => {
          loadWeekData(els.week.value, els.topic.value);
        };

        els.topic.onchange = () => {
          const nu = new URL(window.location.href);
          nu.searchParams.set('week', els.week.value);
          nu.searchParams.set('topic', els.topic.value);
          history.replaceState(null, '', nu.toString());
          renderPaper();
        };

      } catch { showError('Failed to connect to Paper Rank service.'); }
    }

    main();
  </script>
</body>
</html>